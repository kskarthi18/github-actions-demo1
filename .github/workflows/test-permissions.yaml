name: Test Permissions

on:
  workflow_dispatch:  # Manual trigger only

permissions:
  contents: write
  actions: read

jobs:
  test-permissions:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Test GitHub Token permissions
      run: |
        echo "ðŸ” Testing GitHub token permissions..."
        
        # Test basic API access
        echo "ðŸ“‹ Repository information:"
        curl -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
             -H "Accept: application/vnd.github.v3+json" \
             https://api.github.com/repos/${{ github.repository }}
        
        echo -e "\nðŸ“¦ Testing release permissions..."
        # Test if we can access releases endpoint
        curl -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
             -H "Accept: application/vnd.github.v3+json" \
             https://api.github.com/repos/${{ github.repository }}/releases
        
        echo -e "\nâœ… Permission test completed!"
    
    - name: Create test file
      run: echo "Test content" > test-file.txt
    
    - name: Test release creation (dry run)
      uses: softprops/action-gh-release@v2
      with:
        tag_name: test-permissions-${{ github.run_number }}
        name: Test Release ${{ github.run_number }}
        body: |
          This is a test release to verify permissions.
          **This release will be deleted automatically.**
          
          Run Number: ${{ github.run_number }}
          Timestamp: ${{ github.event.head_commit.timestamp }}
        draft: true  # Create as draft so it doesn't pollute releases
        files: test-file.txt
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Clean up test release
      run: |
        echo "ðŸ§¹ Cleaning up test release..."
        gh release delete test-permissions-${{ github.run_number }} --yes || echo "Release not found or already deleted"
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
